<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Page</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/predict_style.css') }}">
    <link rel="stylesheet" href="predict_style.css">
</head>

<body>

    <div class="container">
        <div class="header">
            <h1>Parkinson's Disease Prediction</h1>
            <div class="back-home">
                <a href="/" class="btn">Home</a>
            </div>
        </div>

        <form method="POST" id="predictionForm" action="/predict">

            <div class="form-group">
                <label for="fo">MDVP:Fo(Hz)</label>
                <input type="number" step="any" id="fo" name="fo" required>
            </div>
            <div class="form-group">
                <label for="fhi">MDVP:Fhi(Hz)</label>
                <input type="number" step="any" id="fhi" name="fhi" required>
            </div>
            <div class="form-group">
                <label for="flo">MDVP:Flo(Hz)</label>
                <input type="number" step="any" id="flo" name="flo" required>
            </div>
            <div class="form-group">
                <label for="Jitter">MDVP:Jitter</label>
                <input type="number" step="any" id="Jitter" name="Jitter" required>
            </div>
            <div class="form-group">
                <label for="Shimmer">MDVP:Shimmer</label>
                <input type="number" step="any" id="Shimmer" name="Shimmer" required>
            </div>
            <div class="form-group">
                <label for="HNR">HNR</label>
                <input type="number" step="any" id="HNR" name="HNR" required>
            </div>
            <div class="form-group">
                <label for="RPDE">RPDE</label>
                <input type="number" step="any" id="RPDE" name="RPDE" required>
            </div>
            <div class="form-group">
                <label for="DFA">DFA</label>
                <input type="number" step="any" id="DFA" name="DFA" required>
            </div>
            <div class="form-group">
                <label for="Spread1">Spread1</label>
                <input type="number" step="any" id="Spread1" name="Spread1" required>
            </div>
            <div class="form-group">
                <label for="Spread2">Spread2</label>
                <input type="number" step="any" id="Spread2" name="Spread2" required>
            </div>
            <div class="form-group">
                <label for="D2">D2</label>
                <input type="number" step="any" id="D2" name="D2" required>
            </div>

            <button type="submit">Predict</button>
            <div class="loading" id="loading" style="display:none;">Predicting...</div>
            <div class="result" id="result"></div>
            <div class="instructions" id="instructions" style="display:none;"></div>

        </form>

    </div>

    <script src="{{ url_for('static', filename='js/predict_script.js') }}"></script>
    <!-- <script>
document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('predictionForm');
    const resultDiv = document.getElementById('result');
    const loadingDiv = document.getElementById('loading');
    const instructionsDiv = document.getElementById('instructions');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        resultDiv.innerHTML = '';
        instructionsDiv.style.display = 'none';
        loadingDiv.style.display = 'block';

        // Collect form data
        const formData = new FormData(form);
        const data = {};
        ['fo', 'fhi', 'flo', 'Jitter', 'Shimmer', 'HNR', 'RPDE', 'DFA', 'Spread1', 'Spread2', 'D2'].forEach(key => {
            data[key] = parseFloat(formData.get(key));
        });

        try {
            const response = await fetch('/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            loadingDiv.style.display = 'none';

            // Use only XGBoost model
            const xgbLabel = result.predictions.XGBoost.label;
            const xgbProb = result.predictions.XGBoost.prob;

            resultDiv.innerHTML = `XGBoost Prediction: ${xgbLabel} (Probability: ${xgbProb})`;
            resultDiv.className = 'result ' + (xgbLabel.includes('Parkinson') ? 'positive' : 'negative');

        } catch (err) {
            loadingDiv.style.display = 'none';
            resultDiv.innerHTML = 'Error occurred. Try again!';
            resultDiv.className = 'result negative';
            console.error(err);
        }
    });
});
</script> -->


    <script>
        const form = document.getElementById('predictionForm');
        const resultDiv = document.getElementById('result');
        const loadingDiv = document.getElementById('loading');

        // Create severity button dynamically
        const severityBtn = document.createElement('button');
        severityBtn.textContent = 'Check Severity';
        severityBtn.type = 'button';
        severityBtn.style.display = 'none';
        severityBtn.className = 'btn';
        form.appendChild(severityBtn);

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            resultDiv.innerHTML = '';
            severityBtn.style.display = 'none';
            loadingDiv.style.display = 'block';

            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => data[key] = parseFloat(value));

            try {
                // Call /predict endpoint
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                loadingDiv.style.display = 'none';

                // Show XGBoost prediction
                const xgbLabel = result.predictions.XGBoost.label;
                const xgbProb = result.predictions.XGBoost.prob;
                resultDiv.innerHTML = `XGBoost Prediction: ${xgbLabel} (Probability: ${xgbProb})`;
                resultDiv.className = 'result ' + (xgbLabel.includes('Parkinson') ? 'positive' : 'negative');

                // Show severity button if Parkinson's detected
                if (xgbLabel.includes("Parkinson")) {
                    severityBtn.style.display = 'inline-block';
                    severityBtn.onclick = () => {
                        window.location.href = "/severity_page";
                    };
                }

            } catch (err) {
                loadingDiv.style.display = 'none';
                resultDiv.innerHTML = 'Error occurred. Try again!';
                resultDiv.className = 'result negative';
                console.error(err);
            }
        });
    </script>


</body>

</html>